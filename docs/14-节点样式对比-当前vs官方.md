# 节点样式对比总结：当前系统 vs Palantir官方

## 📅 更新日期
2025-11-07

## 📊 对比图片

### 当前系统（优化前）
路径：`docs/Current-System-Image/pipeline-system-node.png`

**特征**：
- 图标在左上角，较小
- 节点名称在右下角
- 图标和文字之间有较大空白
- 整体布局松散

### Palantir官方
路径：`docs/Palantir-Pipeline-Image/pipeline-graph-ui-node-01.png`

**特征**：
- 图标在浅色背景框内（32×32）
- 节点名称在图标右侧（加粗）
- 列数信息在名称下方
- 右侧边缘有两个圆形端口
- 布局紧凑、专业

---

## 🔧 关键修改点

### 1. 节点尺寸
```typescript
// 修改前
width: 220,
height: 80,

// 修改后（Palantir标准）
width: 240,
height: 72,
```
**说明**：更宽更扁平，符合Palantir的节点比例

### 2. 图标背景框
```typescript
// 新增元素
'icon-bg': {
  x: 12,
  y: 12,
  width: 32,
  height: 32,
  fill: '#EFF8FF',      // 浅蓝色背景
  rx: 4,
  ry: 4
}
```
**说明**：Palantir使用浅色方框包裹图标，增强视觉识别度

### 3. 文字布局
```typescript
// 修改前：文字分散布局
label: { x: 48, y: 28 }   // 图标右侧
meta: { x: 16, y: 56 }    // 下方左对齐

// 修改后：Palantir对齐方式
label: { x: 52, y: 24 }   // 图标背景框右侧
meta: { x: 52, y: 48 }    // 与标题左对齐（垂直排列）
```
**说明**：
- 标题和信息都从图标背景框右侧开始
- 形成清晰的垂直对齐线
- 信息层级更加分明

### 4. 端口位置（重要改进）
```typescript
// 修改前：顶部和底部（传统布局）
in: { position: 'top' }
out: { position: 'bottom' }

// 修改后：Palantir右侧布局
in: { position: { name: 'right', args: { y: 20 } } }
out: { position: { name: 'right', args: { y: 52 } } }
```
**说明**：
- 两个端口都在右侧边缘
- 输入端口在上方（y=20），输出端口在下方（y=52）
- 始终可见（visibility: 'visible'）
- 符合Palantir的连接交互方式

### 5. 颜色系统
```typescript
// 边框色
stroke: '#D0D5DD'        // 柔和的灰色

// 文字色
label: '#101828'         // 深色（加粗标题）
meta: '#667085'          // 灰色（辅助信息）

// 图标背景
'icon-bg': '#EFF8FF'     // 浅蓝色

// 操作按钮
'action-btn': {
  fill: '#F9FAFB',       // 极浅灰
  stroke: '#D0D5DD'
}

// 端口
circle: {
  fill: '#FFFFFF',
  stroke: '#98A2B3'      // 中性灰
}
```

### 6. 字体调整
```typescript
// 节点名称
fontSize: 14,            // 适中大小
fontWeight: 600,         // 加粗（Palantir特征）

// 列数信息
fontSize: 12,            // 较小
fontWeight: normal       // 正常字重
```

---

## 📐 布局结构对比

### 修改前
```
┌──────────────────┐
│ 🗂️                │
│                   │
│        Customers │
│        9 columns │
└──────────────────┘
```
- 图标单独在左上
- 文字在右下
- 空间利用不充分

### 修改后（Palantir）
```
┌──────────────────────────────────┐
│ ┌────┐                         ⊙ │
│ │🗂️  │ customers               ○ │
│ └────┘                         ○ │
│        6 columns                 │
└──────────────────────────────────┘
```
- 图标在浅色背景框内
- 名称紧跟图标右侧
- 信息在下方对齐
- 右侧端口清晰可见

---

## 🎯 设计原理

### Palantir节点设计特点

1. **视觉分组**
   - 图标背景框创建清晰的视觉锚点
   - 文字形成垂直对齐的文本组
   - 右侧端口形成独立的交互区

2. **信息层次**
   - **主要信息**：节点名称（加粗，14px）
   - **次要信息**：列数/状态（常规，12px）
   - **交互元素**：端口和操作按钮

3. **紧凑布局**
   - 减少不必要的留白
   - 元素间距适中（不拥挤也不松散）
   - 240×72的宽扁比例便于横向排列

4. **一致性**
   - 所有数据集节点使用相同的浅蓝色背景
   - 统一的圆角半径（节点6px，图标背景4px）
   - 标准化的间距系统（12px起步）

---

## 📊 详细参数对比表

| 元素 | 属性 | 修改前 | 修改后 | 变化说明 |
|------|------|--------|--------|----------|
| **节点主体** | width | 220px | 240px | +20px 更宽 |
| | height | 80px | 72px | -8px 更扁平 |
| | stroke | #DADCE0 | #D0D5DD | 颜色稍淡 |
| | rx/ry | 8px | 6px | 圆角减小 |
| | 阴影模糊 | 8px | 4px | 更轻微 |
| **图标区域** | 背景框 | 无 | 32×32 | **新增** |
| | 背景色 | - | #EFF8FF | 浅蓝色 |
| | 图标大小 | 24×24 | 20×20 | 稍小 |
| | x坐标 | 16 | 18 | 在背景框内 |
| | y坐标 | 16 | 18 | 在背景框内 |
| **标题文字** | x坐标 | 48 | 52 | 图标框右侧 |
| | y坐标 | 28 | 24 | 上移 |
| | fontSize | 15px | 14px | 稍小 |
| | fontWeight | 500 | 600 | **加粗** |
| | 颜色 | #202124 | #101828 | 更深 |
| **信息文字** | x坐标 | 16 | 52 | **与标题对齐** |
| | y坐标 | 56 | 48 | 上移 |
| | 颜色 | #5F6368 | #667085 | 稍淡 |
| **操作按钮** | cx | 195 | 220 | 右移 |
| | cy | 25 | 18 | 上移 |
| | r | 10 | 8 | 缩小 |
| **输入端口** | 位置 | top | right | **重要变化** |
| | y坐标 | - | 20 | 指定位置 |
| | 半径 | 5 | 6 | +1 |
| | 可见性 | hidden | visible | **始终可见** |
| | 边框色 | #5F6368 | #98A2B3 | 更浅 |
| **输出端口** | 位置 | bottom | right | **重要变化** |
| | y坐标 | - | 52 | 指定位置 |
| | 半径 | 5 | 6 | +1 |
| | 可见性 | hidden | visible | **始终可见** |

---

## ✨ 用户体验提升

### 视觉效果
- ✅ 更专业的外观（与Palantir一致）
- ✅ 更清晰的信息层次
- ✅ 更好的视觉平衡

### 交互改进
- ✅ 端口始终可见，便于连接
- ✅ 右侧端口符合横向流程习惯
- ✅ 紧凑布局节省画布空间

### 一致性
- ✅ 与Palantir官方设计完全一致
- ✅ 符合用户已有的使用习惯
- ✅ 降低学习成本

---

## 🔍 实现细节

### SVG Markup顺序
```typescript
markup: [
  'body',         // 1. 主体背景（最底层）
  'icon-bg',      // 2. 图标背景框
  'icon',         // 3. 图标本身
  'label',        // 4. 节点名称
  'meta',         // 5. 列数信息
  'action-btn'    // 6. 操作按钮（最顶层）
]
```
**说明**：渲染顺序从底层到顶层，确保正确的层叠关系

### 坐标系统
```
起点 (0, 0) 在节点左上角

图标背景框：(12, 12) → (44, 44)
图标：(18, 18) → (38, 38)
标题：从 x=52 开始，y=24 垂直居中
信息：从 x=52 开始，y=48 垂直居中
操作按钮：(220, 18) 右上角
输入端口：(240, 20) 右边缘上方
输出端口：(240, 52) 右边缘下方
```

---

## 📝 代码片段

### 完整的Dataset节点定义
参见文件：`src/components/pipeline/nodes/register.ts` (第9-147行)

### 关键配置
```typescript
// 节点尺寸
width: 240,
height: 72,

// 图标背景
'icon-bg': {
  x: 12, y: 12,
  width: 32, height: 32,
  fill: '#EFF8FF'
}

// 端口位置
ports: {
  groups: {
    in: { position: { name: 'right', args: { y: 20 } } },
    out: { position: { name: 'right', args: { y: 52 } } }
  }
}
```

---

## 🚀 下一步优化建议

### 短期
- [ ] 添加节点悬停效果（端口高亮、阴影加深）
- [ ] 实现节点选中状态（边框变色）
- [ ] 优化其他类型节点（Transform、Join、Output）

### 中期
- [ ] 支持节点类型的动态配色
- [ ] 添加节点状态指示器（运行中、成功、失败）
- [ ] 实现节点的折叠/展开功能

### 长期
- [ ] 节点内容的动态加载
- [ ] 节点的自定义模板系统
- [ ] 节点间的智能对齐和排列

---

**文档版本**: v2.0.0
**更新时间**: 2025-11-07
**参考设计**: Palantir Foundry Pipeline Builder
**修改者**: Claude Code Assistant
