# 节点样式调试指南

## 🔍 当前状态分析

从您提供的截图 (`docs/Current-System-Image/pipeline-system-node.png`) 可以看到：

### ✅ 已生效的样式
- 图标有浅色背景框（左上角）
- 节点是白色卡片
- 右上角有操作按钮

### ❌ 需要修复的问题
- 文字位置不对（"Products"和"8 columns"都在右下角）
- 文字应该在图标右侧，而不是下方

---

## 🛠️ 立即尝试的步骤

### 步骤1：完全刷新页面
1. 关闭所有浏览器标签页
2. 新开标签页访问：**http://localhost:5176/**
3. 进入Pipeline编辑器

### 步骤2：清除画布并添加新节点
1. **删除所有现有节点**（重要！）
2. 点击工具栏的"Add data"
3. 选择"Products"或其他数据集
4. 检查新节点的样式

### 步骤3：检查浏览器开发者工具
打开开发者工具（F12），执行以下检查：

#### 3.1 控制台检查
```javascript
// 在Console中执行，查看节点注册信息
console.log('Checking X6 registered nodes...')
```

查看是否有任何错误信息（红色）。

#### 3.2 检查SVG结构
1. 右键点击节点，选择"检查元素"
2. 找到 `<g>` 标签（节点的容器）
3. 展开查看子元素，应该看到：
   ```html
   <g data-cell-id="...">
     <rect selector="body" />      <!-- 节点主体 -->
     <rect selector="icon-bg" />   <!-- 图标背景 -->
     <image selector="icon" />     <!-- 图标 -->
     <text selector="label">Products</text>    <!-- 名称 -->
     <text selector="meta">8 columns</text>    <!-- 信息 -->
     <circle selector="action-btn" />          <!-- 操作按钮 -->
   </g>
   ```

#### 3.3 检查文字元素属性
找到 `<text selector="label">` 元素，查看它的属性：
```html
<text x="52" y="20" font-size="14" font-weight="600" fill="#101828">
  Products
</text>
```

**关键检查点**：
- ✅ x 应该是 52
- ✅ y 应该是 20（我刚修改的）
- ✅ font-weight 应该是 600

---

## 📊 预期的坐标布局

```
节点 (240×72)
┌─────────────────────────────────────────┐
│ [12,12]                                  │
│   ┌──────┐ [52,20]                       │
│   │图标  │ Products  ← label文字         │
│   │32×32 │                               │
│   └──────┘ [52,38]                       │
│            8 columns  ← meta文字         │
└─────────────────────────────────────────┘
```

### 坐标说明
- 图标背景：x=12, y=12, 大小32×32
- 图标本身：x=18, y=18, 大小20×20
- 节点名称：x=52, y=20（刚调整过，之前是24）
- 列数信息：x=52, y=38（刚调整过，之前是48）

---

## 🐛 如果问题仍然存在

### 可能原因1：浏览器缓存
**解决方案**：
```
1. 按 Ctrl+Shift+Delete 打开清除浏览器数据
2. 选择"缓存的图像和文件"
3. 时间范围选择"全部时间"
4. 点击"清除数据"
5. 关闭浏览器，重新打开
```

### 可能原因2：旧节点未更新
**解决方案**：
- 画布上的旧节点不会自动更新样式
- **必须删除旧节点，重新添加新节点**
- 只有新添加的节点才会使用新样式

### 可能原因3：SVG文本的y坐标计算问题
**问题描述**：
SVG `<text>` 元素的 `y` 坐标指的是**文字基线**（baseline）位置，不是文字顶部。

**如果文字还是太靠下**，尝试以下手动调整：

编辑 `src/components/pipeline/nodes/register.ts`，进一步减小y值：

```typescript
label: {
  x: 52,
  y: 18,  // 从20改为18（再上移2px）
  // ...
},
meta: {
  x: 52,
  y: 34,  // 从38改为34（再上移4px）
  // ...
}
```

---

## 🧪 手动测试不同的y坐标

如果您想快速测试不同的y坐标，可以在浏览器控制台中执行：

```javascript
// 获取画布上的第一个节点
const graph = window.__x6_graph_instance__ // 如果graph实例暴露在window上
const nodes = graph.getNodes()
const node = nodes[0]

// 测试不同的y坐标
node.attr('label/y', 18)  // 尝试y=18
node.attr('meta/y', 34)   // 尝试y=34

// 查看效果后，如果合适，就修改代码中的y值
```

---

## 📝 关键代码位置

### 文件：`src/components/pipeline/nodes/register.ts`

**当前配置**（第75-93行）：
```typescript
label: {
  x: 52,
  y: 20,        // ← 调整这个值
  fontSize: 14,
  fontWeight: 600,
  fill: '#101828',
  text: 'Dataset',
  textAnchor: 'start',
  fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif'
},
meta: {
  x: 52,
  y: 38,        // ← 调整这个值
  fontSize: 12,
  fill: '#667085',
  text: '0 columns',
  textAnchor: 'start',
  fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif'
}
```

---

## 🎯 理想的最终效果

参考 `docs/Palantir-Pipeline-Image/pipeline-graph-ui-node-01.png`：

```
┌──────────────────────────────────────┐
│ ┌────┐                             ⊙ │
│ │🗂️  │ customers                   ○ │
│ └────┘                             ○ │
│        6 columns                     │
└──────────────────────────────────────┘
```

- 图标和名称在同一视觉行
- 列数信息紧跟在下方
- 右侧有两个端口（圆圈）

---

## 💬 需要的反馈信息

如果问题仍未解决，请提供：

1. **控制台截图**（F12 → Console标签）
2. **节点检查元素截图**（右键节点 → 检查）
   - 特别是 `<text selector="label">` 的完整属性
3. **当前节点外观截图**（删除旧节点后，添加新节点的截图）
4. **开发者工具 → Elements 中节点的完整HTML结构**

这将帮助我精确定位问题所在。

---

## 🔧 快速修复建议

### 如果文字太靠下
减小y值：
```typescript
label: { y: 16 }  // 从20减到16
meta: { y: 32 }   // 从38减到32
```

### 如果文字太靠上
增大y值：
```typescript
label: { y: 22 }  // 从20增到22
meta: { y: 40 }   // 从38增到40
```

### 如果文字位置完全错误
可能需要使用 `dominant-baseline` 属性：
```typescript
label: {
  x: 52,
  y: 28,  // 图标垂直中心
  dominantBaseline: 'middle',  // 垂直居中对齐
  textAnchor: 'start'
}
```

---

**调试版本**: v1.0.0
**最后更新**: 2025-11-07
**开发服务器**: http://localhost:5176/
