# Pipeline Builder - 功能对标分析与开发计划

> 对标 Palantir Foundry Pipeline Builder 的完整功能分析与实施路线图
>
> 创建时间：2025-11-11
> 版本：v1.0

---

## 📊 当前项目实现状态总结

### ✅ 已完成的核心功能 (70%完成度)

#### 1. 基础图编辑能力
- [x] AntV X6 图编辑器集成
- [x] 节点拖拽和移动
- [x] 节点连线（自动吸附）
- [x] 缩放和平移画布
- [x] 快捷键支持（Ctrl+C, Ctrl+V, Delete）
- [x] 撤销/重做（基础实现）
- [x] 节点选择（单选、框选）
- [x] 自动布局
- [x] 对齐辅助线

#### 2. 节点系统
- [x] Dataset节点（数据源）
  - 支持3个模拟数据集（Products, Customers, Transactions）
  - 左右端口布局
  - 蓝色主题（#4285F4）
- [x] Transform节点（数据转换）
  - 支持多种转换类型
  - 紫色主题（#1570EF）
  - 双击打开配置面板
- [x] Join节点（连接）
  - 支持4种Join类型（Inner, Left, Right, Outer）
  - 橙色主题（#F59E0B）
  - 2个输入端口
- [x] Output节点（输出）
  - 紫色主题（#8B5CF6）
  - 标记数据流终点

#### 3. 数据转换系统
- [x] Filter（过滤）
  - 支持10种操作符（=, !=, >, >=, <, <=, in, contains, starts_with, ends_with）
  - 多种数据类型支持
- [x] Sort（排序）
  - 升序/降序
- [x] Group By（分组聚合）
  - 6种聚合函数（count, sum, avg, min, max, first, last）
- [x] Cast（类型转换）
  - 支持String, Number, Date, Boolean
- [x] Distinct（去重）
- [x] Join（连接）
  - Inner/Left/Right/Outer Join

#### 4. 数据流执行引擎
- [x] 拓扑排序算法
- [x] 循环依赖检测
- [x] 节点数据缓存（Map-based）
- [x] 下游缓存自动失效
- [x] Pipeline执行和结果输出

#### 5. UI/UX功能
- [x] Palantir风格顶部导航
- [x] 工具栏（Toolbar）
  - Add Data下拉菜单
  - 快捷按钮（Transform, Join, Output）
  - 选择/删除/布局控制
- [x] 右侧面板（Right Panel）
  - Pipeline Outputs管理
  - Transform配置面板
  - Legend和Settings
- [x] 底部面板（Bottom Panel）
  - Selection Preview（About, Columns, Schedules标签）
  - Data Preview表格
  - Suggestions
- [x] 右键上下文菜单
  - Open, Actions, Rename, Copy, Delete等
- [x] 节点重命名Modal（专业弹窗，替代了browser prompt）
- [x] 数据清理操作浮动菜单（最新添加）
  - 点击Dataset节点显示Transform/Join/Union选项
  - 自动连接和节点创建

#### 6. 数据管理
- [x] 模拟数据系统
  - 3个数据集（12+10+15行）
  - 完整的列定义和类型信息
- [x] 数据预览表格
  - 列统计信息
  - 样本值显示
- [x] Pipeline持久化（localStorage）
- [x] 自动加载和恢复

---

## 🎯 Palantir官方功能对标分析

### 功能对比矩阵

| 功能模块 | Palantir官方 | 当前实现 | 完成度 | 优先级 |
|---------|------------|---------|--------|--------|
| **图编辑器核心** | ✅ | ✅ | 90% | ✅完成 |
| **节点拖拽添加** | ✅ | ❌ | 0% | 🔴高 |
| **节点类型系统** | ✅ | ✅ | 70% | 🟡中 |
| **数据转换操作** | ✅ (30+种) | ✅ (6种) | 20% | 🔴高 |
| **数据预览** | ✅ | ✅ | 80% | ✅完成 |
| **执行引擎** | ✅ | ✅ | 70% | 🟡中 |
| **实时监控** | ✅ | ❌ | 0% | 🟡中 |
| **日志查看器** | ✅ | ❌ | 0% | 🟡中 |
| **版本管理** | ✅ | ❌ | 0% | 🟢低 |
| **协作功能** | ✅ | ❌ | 0% | 🟢低 |
| **调度系统** | ✅ | ❌ | 0% | 🟢低 |
| **数据质量检测** | ✅ | ❌ | 0% | 🟡中 |
| **性能监控** | ✅ | ❌ | 0% | 🟡中 |
| **代码编辑器** | ✅ (Python/SQL) | ❌ | 0% | 🔴高 |
| **数据导入导出** | ✅ | ❌ | 0% | 🔴高 |
| **数据血缘** | ✅ | ❌ | 0% | 🟢低 |

### 详细功能差距分析

#### 🔴 高优先级差距（核心功能）

##### 1. 节点拖拽面板 (Node Palette)
**Palantir实现**：
- 左侧可折叠面板
- 节点分类（Data Sources, Transforms, Outputs）
- 拖拽到画布创建节点
- 搜索和过滤节点

**当前状态**：❌ 未实现
- 仅通过工具栏按钮添加
- 无节点分类展示
- 无拖拽创建

**开发工作量**：3-5天

##### 2. Transform类型扩展
**Palantir实现**（30+种转换）：
- Select Columns（选择列）
- Rename Columns（重命名列）
- Add Column（添加计算列）
- Remove Column（删除列）
- Trim（去除空白）
- Replace（替换值）
- Split Column（拆分列）
- Merge Columns（合并列）
- Fill Null（填充空值）
- Remove Duplicates（去重）
- Pivot（透视）
- Unpivot（逆透视）
- Window Functions（窗口函数）
- Custom Python/SQL

**当前状态**：✅ 部分实现
- ✅ Filter, Sort, Group By, Cast, Distinct, Join
- ❌ 其他24种转换

**开发工作量**：15-20天（分批实现）

##### 3. Monaco代码编辑器集成
**Palantir实现**：
- Python代码转换
- SQL查询转换
- 语法高亮
- 智能提示
- 错误检测

**当前状态**：❌ 未实现

**开发工作量**：5-7天

##### 4. 数据导入导出
**Palantir实现**：
- CSV文件上传
- Excel文件支持
- JSON数据导入
- 数据集导出
- Pipeline JSON导出

**当前状态**：❌ 未实现
- 仅支持3个内置模拟数据集

**开发工作量**：4-6天

#### 🟡 中优先级差距（增强功能）

##### 5. 实时执行监控
**Palantir实现**：
- 实时进度显示
- 每个节点的执行状态
- 数据流动可视化
- 性能指标（处理时间、数据量）

**当前状态**：❌ 未实现
- 仅有基础执行结果输出

**开发工作量**：7-10天

##### 6. 日志系统
**Palantir实现**：
- 结构化日志查看器
- 日志级别过滤（DEBUG, INFO, WARNING, ERROR）
- 日志搜索
- 日志导出
- 实时日志流

**当前状态**：❌ 未实现
- 仅console.log输出

**开发工作量**：5-7天

##### 7. 数据质量检测
**Palantir实现**：
- 空值检测
- 重复值检测
- 数据类型一致性检查
- 数据分布统计
- 质量报告生成

**当前状态**：❌ 未实现

**开发工作量**：8-10天

##### 8. 性能优化和监控
**Palantir实现**：
- 大数据集支持（>1M行）
- 分页加载
- 虚拟滚动
- 性能瓶颈分析
- 优化建议

**当前状态**：❌ 未实现
- 数据量限制在<1000行

**开发工作量**：10-15天

#### 🟢 低优先级差距（高级功能）

##### 9. 版本管理
**Palantir实现**：
- Pipeline版本历史
- 版本对比
- 回滚功能
- 标签管理

**当前状态**：❌ 未实现

**开发工作量**：7-10天

##### 10. 协作功能
**Palantir实现**：
- 多人实时编辑
- 评论和标注
- 权限管理
- 变更通知

**当前状态**：❌ 未实现

**开发工作量**：15-20天

##### 11. 调度系统
**Palantir实现**：
- 定时执行
- 触发器配置
- 依赖管理
- 执行历史

**当前状态**：❌ 未实现

**开发工作量**：10-15天

##### 12. 数据血缘分析
**Palantir实现**：
- 数据流向可视化
- 影响分析
- 上下游依赖追踪

**当前状态**：❌ 未实现

**开发工作量**：10-12天

---

## 🗺️ 开发路线图

### 第一阶段：核心功能完善 (2-3周)

**目标**：补齐核心交互和常用转换，达到基础可用

#### Week 1: 节点系统增强
- [ ] **Day 1-2**: 节点拖拽面板（Node Palette）
  - 创建左侧可折叠面板组件
  - 实现节点拖拽到画布功能
  - 节点分类展示

- [ ] **Day 3-4**: Transform类型扩展（第一批）
  - Select Columns组件
  - Rename Columns组件
  - Add Column组件（支持简单表达式）

- [ ] **Day 5**: Join节点配置增强
  - 完善Join配置UI
  - 添加列选择器
  - 预览Join结果

#### Week 2: 代码编辑器和数据导入
- [ ] **Day 1-3**: Monaco编辑器集成
  - 安装monaco-editor
  - 创建CodeEditorComponent
  - Python/SQL语法支持
  - 主题适配

- [ ] **Day 4-5**: 数据导入功能
  - CSV文件上传组件
  - 文件解析器
  - 数据预览和验证
  - 动态Dataset节点创建

#### Week 3: Transform扩展和UI优化
- [ ] **Day 1-2**: Transform类型扩展（第二批）
  - Remove Column
  - Trim
  - Replace
  - Split Column

- [ ] **Day 3-4**: 数据导出功能
  - CSV导出
  - Excel导出（使用xlsx库）
  - Pipeline JSON导出

- [ ] **Day 5**: UI细节优化
  - 工具提示完善
  - 快捷键帮助面板
  - 错误提示优化

### 第二阶段：监控和可观测性 (2-3周)

#### Week 4: 执行监控
- [ ] 实时执行进度条
- [ ] 节点状态可视化（Running, Success, Failed）
- [ ] 数据流动画效果
- [ ] 执行时间统计

#### Week 5: 日志系统
- [ ] 结构化日志组件
- [ ] 日志级别过滤
- [ ] 日志搜索和高亮
- [ ] 日志导出功能

#### Week 6: 数据质量
- [ ] 数据质量检测器
- [ ] 空值/重复值分析
- [ ] 数据分布统计图表
- [ ] 质量报告生成

### 第三阶段：性能和扩展 (3-4周)

#### Week 7-8: 性能优化
- [ ] 大数据集支持（分页加载）
- [ ] 虚拟滚动实现
- [ ] Web Worker并行处理
- [ ] 内存优化

#### Week 9-10: 高级功能
- [ ] 版本管理系统
- [ ] Pipeline模板
- [ ] 数据血缘可视化
- [ ] 高级搜索和过滤

---

## 📋 实施优先级详细分解

### 🔥 P0 - 立即开始（本周）

#### 1. 节点拖拽面板 (3天)
```
优先级：P0
影响：大幅提升用户体验
依赖：无
工作量：3天
```

**实施步骤**：
1. 创建NodePalette组件
2. 实现可折叠侧边栏
3. 添加节点拖拽逻辑
4. 集成到主编辑器

#### 2. Transform扩展 - 第一批 (5天)
```
优先级：P0
影响：满足基本数据处理需求
依赖：无
工作量：5天
```

**包含转换**：
- Select Columns（2天）
- Rename Columns（1天）
- Add Column - 简单表达式（2天）

### 🚀 P1 - 近期完成（2周内）

#### 3. Monaco编辑器 (5天)
```
优先级：P1
影响：支持复杂数据转换
依赖：无
工作量：5天
```

#### 4. 数据导入 (4天)
```
优先级：P1
影响：支持真实数据源
依赖：无
工作量：4天
```

#### 5. Transform扩展 - 第二批 (5天)
```
优先级：P1
影响：完善常用转换
依赖：无
工作量：5天
```

### ⚡ P2 - 中期规划（1个月内）

#### 6. 执行监控 (7天)
#### 7. 日志系统 (5天)
#### 8. 数据导出 (3天)
#### 9. 数据质量检测 (8天)

### 📅 P3 - 长期规划（2-3个月）

#### 10. 性能优化
#### 11. 版本管理
#### 12. 协作功能
#### 13. 调度系统
#### 14. 数据血缘

---

## 🎨 UI/UX改进建议

### 当前问题
1. ❌ 节点只能通过按钮添加，不符合Palantir拖拽习惯
2. ❌ Transform配置面板缺少部分转换类型
3. ❌ 缺少执行状态可视化
4. ❌ 错误提示不够友好
5. ❌ 缺少快捷键提示

### 改进方案
1. ✅ 添加左侧节点拖拽面板
2. ✅ 完善Transform配置UI
3. ✅ 添加节点状态图标（运行中/成功/失败）
4. ✅ 统一错误处理和提示
5. ✅ 添加快捷键帮助面板（?键）

---

## 📊 技术债务清单

### 代码质量
- [ ] 添加完整的TypeScript类型定义
- [ ] 单元测试覆盖率提升至80%
- [ ] E2E测试套件
- [ ] 代码规范检查（ESLint严格模式）
- [ ] 性能监控埋点

### 架构优化
- [ ] 组件拆分和解耦
- [ ] State管理优化（Pinia模块化）
- [ ] API层统一封装
- [ ] 错误边界处理
- [ ] 加载状态统一管理

### 文档完善
- [ ] 组件开发文档
- [ ] API文档
- [ ] 贡献指南
- [ ] 部署文档

---

## 🎯 本周执行计划

### Day 1-2: 节点拖拽面板
1. **上午**：设计NodePalette组件结构
2. **下午**：实现基础拖拽功能
3. **第二天上午**：添加节点分类
4. **第二天下午**：UI美化和测试

### Day 3-4: Select Columns Transform
1. **上午**：设计SelectColumnsTransform组件
2. **下午**：实现列选择逻辑
3. **第二天上午**：添加预览功能
4. **第二天下午**：集成测试

### Day 5: Rename Columns Transform
1. **上午**：设计RenameColumnsTransform组件
2. **下午**：实现重命名逻辑和测试

---

## 📈 成功指标

### 第一阶段目标（3周后）
- [ ] 节点拖拽功能100%可用
- [ ] Transform类型达到15种
- [ ] Monaco编辑器集成完成
- [ ] CSV导入功能可用
- [ ] 用户满意度调查 >8分

### 第二阶段目标（6周后）
- [ ] 执行监控功能完整
- [ ] 日志系统可用
- [ ] 数据质量检测上线
- [ ] 性能支持10K+行数据
- [ ] 功能完成度达到85%

### 第三阶段目标（3个月后）
- [ ] 所有P0/P1功能完成
- [ ] 大数据支持（100K+行）
- [ ] 版本管理可用
- [ ] 功能完成度达到95%
- [ ] 生产环境部署就绪

---

## 📝 总结

### 当前优势
✅ 核心图编辑功能完整
✅ 数据流执行引擎稳定
✅ UI设计符合Palantir规范
✅ 代码架构清晰
✅ 文档完善

### 主要差距
❌ 节点交互方式（拖拽 vs 按钮）
❌ Transform类型数量（6 vs 30+）
❌ 高级功能缺失（监控、日志、版本）
❌ 数据导入导出功能
❌ 代码编辑器

### 建议路径
1. **先补齐核心交互**（节点拖拽、Transform扩展）
2. **再完善可观测性**（监控、日志）
3. **最后添加高级功能**（版本、协作、调度）
4. **持续优化性能和体验**

---

**文档版本**: v1.0
**创建日期**: 2025-11-11
**下次更新**: 每周五更新进度
