# Pipeline Builder 用户界面交互手册

## 目录

1. [概述](#概述)
2. [系统入口与导航](#系统入口与导航)
3. [管道列表页面](#管道列表页面)
4. [管道编辑器](#管道编辑器)
5. [画布操作](#画布操作)
6. [节点操作](#节点操作)
7. [数据转换配置](#数据转换配置)
8. [快捷键参考](#快捷键参考)
9. [常见操作流程](#常见操作流程)

---

## 概述

Pipeline Builder 是一个企业级可视化数据流水线构建平台，采用拖拽式交互设计，支持复杂的 ETL（Extract-Transform-Load）数据处理工作流。本手册详细介绍系统的 UI/UE 交互逻辑和操作方法。

### 设计理念

- **所见即所得**：实时预览数据转换结果
- **低代码/无代码**：通过可视化配置完成数据处理
- **灵活性**：支持 60+ 种数据转换操作
- **效率优先**：丰富的快捷键和批量操作支持

---

## 系统入口与导航

### 主导航菜单

系统左侧提供三个主要导航入口：

| 菜单项 | 图标 | 功能说明 |
|--------|------|----------|
| **管道列表** | 📦 appstore | 查看和管理所有数据管道 |
| **执行历史** | ▶️ play-circle | 查看管道执行记录和状态 |
| **数据源** | 🗄️ database | 管理数据源连接配置 |

### 顶部状态栏

- **左侧**：系统 Logo "Pipeline Builder"
- **右侧**：用户信息（欢迎, Guest）、退出按钮

---

## 管道列表页面

### 页面布局

```
┌─────────────────────────────────────────────────────────────┐
│  管道列表                     [加载演示Pipeline] [+ 创建管道] │
├─────────────────────────────────────────────────────────────┤
│  名称    │    描述    │   创建时间   │  创建人  │   操作     │
├─────────────────────────────────────────────────────────────┤
│  示例管道 │ 这是一个...│ 2025-11-26  │  admin  │ 编辑 运行 删除│
└─────────────────────────────────────────────────────────────┘
```

### 操作按钮

#### 1. 加载演示 Pipeline
- **位置**：页面右上角
- **功能**：一键加载预配置的完整演示流水线
- **用途**：快速了解系统功能、学习最佳实践

#### 2. 创建管道
- **位置**：页面右上角（蓝色主按钮）
- **触发**：点击后弹出创建管道对话框

### 创建管道对话框

#### 对话框结构

```
┌──────────────────────────────────────────┐
│              创建新管道                   │
├──────────────────────────────────────────┤
│  管道类型 *                               │
│  ┌─────────────────┐ ┌─────────────────┐ │
│  │ 📊 Batch Pipeline│ │⚡Streaming Pipeline│
│  │ 批处理管道       │ │ 实时流式管道      │ │
│  │ ◉ 选中          │ │ ○               │ │
│  └─────────────────┘ └─────────────────┘ │
│                                          │
│  管道名称 *                               │
│  ┌────────────────────────────────────┐  │
│  │ 输入管道名称                        │  │
│  └────────────────────────────────────┘  │
│                                          │
│  描述 (可选)                              │
│  ┌────────────────────────────────────┐  │
│  │ 输入管道的描述信息...               │  │
│  │                                    │  │
│  └────────────────────────────────────┘  │
│                                   0/500  │
│                                          │
│  保存位置                                 │
│  ┌────────────────────────────────────┐  │
│  │ 📁 /pipelines                    ▼ │  │
│  └────────────────────────────────────┘  │
│  ⓘ 管道将保存到所选文件夹中              │
│                                          │
│                    [取消]  [创建管道]     │
└──────────────────────────────────────────┘
```

#### 字段说明

| 字段 | 必填 | 说明 |
|------|------|------|
| 管道类型 | ✅ | Batch Pipeline（批处理）或 Streaming Pipeline（流式） |
| 管道名称 | ✅ | 唯一标识符，建议使用有意义的命名 |
| 描述 | ❌ | 最多 500 字符的说明文本 |
| 保存位置 | ✅ | 选择存储目录，默认 /pipelines |

#### 交互逻辑

1. **类型选择**：点击卡片切换，选中状态显示蓝色边框和选中图标
2. **表单验证**：名称为空时"创建管道"按钮禁用
3. **创建成功**：自动跳转到管道编辑器页面

### 列表操作

每行数据提供三个操作按钮：

| 操作 | 说明 |
|------|------|
| **编辑** | 进入管道编辑器修改配置 |
| **运行** | 执行当前管道 |
| **删除** | 删除管道（需确认） |

---

## 管道编辑器

### 整体布局

```
┌─────────────────────────────────────────────────────────────────────────┐
│ ← [Gena] Palantir > Deep Dive > Pipeline  │ [图形][提议][历史] │ [保存][部署] │
├──────────────────────────────────────────┬──────────────────────────────┤
│ 工具栏                                    │                              │
│ [工具][选择][移除][布局][添加数据▼][转换][编辑] [导出][运行]               │
├──────────────────────────────────────────┤     右侧面板                  │
│                                          │  ┌────────────────────────┐  │
│                                          │  │ 🔍 Search Nodes        │  │
│           画  布  区  域                  │  ├────────────────────────┤  │
│                                          │  │ 管道输出               │  │
│    ┌──────┐    ┌──────┐    ┌──────┐     │  │ [+ 添加管道输出]       │  │
│    │数据集 │───▶│ 转换  │───▶│ 输出  │     │  ├────────────────────────┤  │
│    └──────┘    └──────┘    └──────┘     │  │ 图例                   │  │
│                                          │  │ ■ Dataset node         │  │
│                                          │  │ ■ Transform node       │  │
│                                          │  │ ■ Join node            │  │
│                  [缩放控制]              │  │ ■ Output node          │  │
│                  86% [+][-][⊡][1:1][⊙]   │  ├────────────────────────┤  │
├──────────────────────────────────────────┤  │ 画布设置               │  │
│ 底部面板 [选择预览][预览][建议]           │  │ Show grid      [开关]  │  │
├──────────────────────────────────────────┤  │ Snap to grid   [开关]  │  │
│ [关于] [列] [调度]                        │  │ Auto layout    [开关]  │  │
│ 节点详细信息...                           │  └────────────────────────┘  │
└──────────────────────────────────────────┴──────────────────────────────┘
```

### 顶部导航栏

#### 面包屑导航
- 显示当前管道的层级路径
- 点击可返回上级目录

#### 视图切换
| 按钮 | 功能 |
|------|------|
| 图形 | 可视化图形编辑视图（默认） |
| 提议 | 查看和管理变更提议 |
| 历史记录 | 查看版本历史 |

#### 操作按钮组
| 按钮 | 快捷键 | 功能 |
|------|--------|------|
| ↩️ Undo | Ctrl+Z | 撤销上一步操作 |
| ↪️ Redo | Ctrl+Y | 重做操作 |
| 💾 保存 | Ctrl+S | 保存当前管道 |
| 提议 | - | 创建变更提议 |
| 部署 | - | 部署管道到生产环境 |

---

## 画布操作

### 工具栏详解

#### 工具组

| 按钮 | 图标 | 功能 | 说明 |
|------|------|------|------|
| 拖动 | ✋ drag | 平移画布 | 按住拖动可移动整个画布视图 |
| 选择 | ↖️ select | 选择节点 | 默认工具，点击或框选节点 |

#### 选择组

| 按钮 | 快捷键 | 功能 |
|------|--------|------|
| 全选 | Ctrl+A | 选中画布上所有节点 |
| 清除选择 | Esc | 取消所有选中状态 |

#### 移除组

| 按钮 | 快捷键 | 功能 |
|------|--------|------|
| 删除选中 | Delete | 删除当前选中的节点/边 |

#### 布局组

| 按钮 | 功能 | 说明 |
|------|------|------|
| 自动布局 | 自动排列节点 | 基于 DAG 结构优化节点位置 |
| 适配屏幕 | 缩放至最佳视图 | 让所有节点在视口内可见 |

#### 添加数据下拉菜单

点击"添加数据"按钮展开菜单：

```
┌─────────────────────────────────┐
│ 📤 Import CSV/JSON...           │
├─────────────────────────────────┤
│ 🗄️ Products (12 rows · 8 columns)│
│ 🗄️ Customers (10 rows · 9 columns)│
│ 🗄️ Transactions (15 rows · 9 columns)│
└─────────────────────────────────┘
```

- **Import CSV/JSON**：上传本地数据文件
- **内置数据集**：快速添加示例数据

#### 转换组

| 按钮 | 图标 | 功能 |
|------|------|------|
| 添加转换节点 | 🔀 filter | 添加数据转换节点 |
| 添加连接节点 | 🔗 merge-cells | 添加 Join 连接节点 |
| 添加输出节点 | 📤 export | 添加输出目标节点 |

#### 编辑组

| 按钮 | 快捷键 | 功能 |
|------|--------|------|
| 撤销 | Ctrl+Z | 撤销上一步 |
| 重做 | Ctrl+Y | 重做操作 |

#### 执行组

| 按钮 | 功能 |
|------|------|
| 导出 | 导出数据（选中节点后可用） |
| 运行 | 执行当前管道 |

### 缩放控制

位于画布右下角的缩放控制面板：

| 控件 | 快捷键 | 功能 |
|------|--------|------|
| 当前缩放 | - | 显示当前缩放百分比（如 86%） |
| + | Ctrl+= | 放大视图 |
| - | Ctrl+- | 缩小视图 |
| ⊡ | Ctrl+1 | 适应窗口大小 |
| 1:1 | Ctrl+0 | 恢复 100% 实际大小 |
| ⊙ | - | 居中显示 |

### 画布交互

#### 平移画布
- **方式1**：切换到"拖动"工具后拖动
- **方式2**：按住空格键 + 鼠标拖动
- **方式3**：鼠标中键拖动

#### 缩放画布
- **鼠标滚轮**：上滚放大，下滚缩小
- **快捷键**：Ctrl + 加号/减号
- **控制面板**：点击 +/- 按钮

#### 框选节点
1. 确保当前工具为"选择"
2. 在空白处按下鼠标左键
3. 拖动形成选择框
4. 释放后框内节点被选中

---

## 节点操作

### 节点类型

系统支持四种节点类型，通过颜色区分：

| 类型 | 颜色 | 图标 | 用途 |
|------|------|------|------|
| Dataset | 🔵 蓝色 | 📊 | 数据源输入 |
| Transform | 🟢 绿色 | 🔀 | 数据转换处理 |
| Join | 🟠 橙色 | 🔗 | 多数据源连接 |
| Output | 🔴 红色 | 📤 | 输出目标 |

### 节点结构

```
┌───────────────────────────────┐
│ 📊 Products                   │ ← 节点名称
│ 12 rows · 8 columns           │ ← 数据统计
│                         ○──── │ ← 输出连接点
└───────────────────────────────┘
```

### 添加节点

#### 方式1：工具栏添加
1. 点击"添加数据"下拉菜单选择数据源
2. 点击转换组按钮添加相应节点

#### 方式2：节点菜单添加
1. 选中已有节点
2. 在弹出的操作菜单中选择：
   - **Transform**：添加转换节点
   - **Join**：添加连接节点
   - **Union**：添加合并节点

### 选中节点

#### 单选
- 点击节点即可选中
- 选中状态：蓝色边框高亮

#### 多选
- **Ctrl+点击**：追加选中
- **框选**：拖动选择框
- **Ctrl+A**：全选

#### 选中后状态
- 左下角显示"N item(s) selected"
- 工具栏"删除"按钮变为可用
- "导出"按钮变为可用

### 移动节点

1. 选中要移动的节点
2. 拖动到目标位置
3. 释放鼠标完成移动

**提示**：启用"Snap to grid"时，节点会自动对齐到网格

### 连接节点

1. 将鼠标悬停在源节点的输出连接点（右侧圆点）
2. 按下鼠标左键并拖动
3. 拖动到目标节点的输入连接点（左侧）
4. 释放完成连接

### 右键菜单

在节点上右键点击，显示上下文菜单：

```
┌─────────────────────────┐
│ 📂 Open                 │ ← 打开节点详情
│ ✏️ Rename               │ ← 重命名节点
│ 📋 Copy                 │ ← 复制节点
│ 📄 Duplicate            │ ← 复制节点
│ 🎨 Highlight         ▶ │ ← 高亮设置
├─────────────────────────┤
│ 👁️ Preview data         │ ← 预览数据
│ 📤 Export data          │ ← 导出数据
├─────────────────────────┤
│ 🔧 Add transformation   │ ← 添加转换
│ 🗑️ Delete node          │ ← 删除节点
└─────────────────────────┘
```

#### 菜单功能详解

| 菜单项 | 功能说明 |
|--------|----------|
| Open | 打开节点的详细配置页面 |
| Rename | 重命名当前节点 |
| Copy | 复制节点到剪贴板 |
| Duplicate | 在画布上创建节点副本 |
| Highlight | 设置节点高亮颜色标记 |
| Preview data | 在底部面板预览节点数据 |
| Export data | 导出节点数据为 CSV/JSON/Excel |
| Add transformation | 添加下游转换节点 |
| Delete node | 删除当前节点 |

### 节点操作菜单

单击选中节点后，会在节点旁边显示快捷操作菜单：

```
┌─────────────┐
│ 🔀 Transform │
│ 🔗 Join      │
│ ➕ Union     │
└─────────────┘
```

点击相应选项可快速添加下游节点并自动连接。

---

## 数据转换配置

### 转换选择面板

点击 Transform 后弹出转换选择面板：

```
┌──────────────────────────────────────────────────────────────┐
│ 🔍 搜索转换和列...                                            │
├───────────────┬──────────────────────────────────────────────┤
│               │  选择要使用的转换                    [清除]   │
│  全部         │  ┌─────────────────────────────────────────┐ │
│  常用         │  │ 筛选                                    │ │
│  自定义函数   │  │ 基于选定列的比较条件筛选行。            │ │
│  UDF函数      │  ├─────────────────────────────────────────┤ │
│  聚合         │  │ 聚合                                    │ │
│  数组         │  │ 对行进行分组并应用聚合函数。            │ │
│  二进制       │  ├─────────────────────────────────────────┤ │
│  布尔值       │  │ 排序                                    │ │
│  类型转换     │  │ 按列值对行进行排序。                    │ │
│  数据准备     │  ├─────────────────────────────────────────┤ │
│  日期时间     │  │ 类型转换                                │ │
│               │  │ 将列转换为不同类型。                    │ │
│               │  └─────────────────────────────────────────┘ │
└───────────────┴──────────────────────────────────────────────┘
```

### 转换分类

| 分类 | 包含操作 |
|------|----------|
| **常用** | 筛选、聚合、排序、类型转换、选择列 |
| **自定义函数** | Python Code、SQL Query |
| **UDF函数** | 用户自定义函数 |
| **聚合** | GroupBy、Sum、Count、Average 等 |
| **数组** | 数组操作函数 |
| **二进制** | 二进制数据处理 |
| **布尔值** | 布尔逻辑运算 |
| **类型转换** | Cast、Format 等类型转换 |
| **数据准备** | 清洗、规范化、去重等 |
| **日期时间** | 日期格式化、提取、计算等 |

### 常用转换配置

#### 筛选 (Filter)

```
┌──────────────────────────────────────┐
│ 筛选                                  │
│ 基于选定列的比较条件筛选行。          │
├──────────────────────────────────────┤
│ * 保留行                              │
│ ┌──────────────────────────────────┐ │
│ │ 满足所有条件                   ▼ │ │
│ └──────────────────────────────────┘ │
│                                      │
│ * 列                                 │
│ ┌──────────────────────────────────┐ │
│ │ 选择列                         ▼ │ │
│ └──────────────────────────────────┘ │
│                                      │
│ * 操作符                             │
│ ┌──────────────────────────────────┐ │
│ │ 等于                           ▼ │ │
│ └──────────────────────────────────┘ │
│                                      │
│ * 值                                 │
│ ┌──────────────────────────────────┐ │
│ │ 输入值                           │ │
│ └──────────────────────────────────┘ │
│                                      │
│        [+ 添加条件]                   │
│                                      │
│              [取消]  [应用]           │
└──────────────────────────────────────┘
```

**配置项说明：**

| 字段 | 选项/说明 |
|------|-----------|
| 保留行 | 满足所有条件 / 满足任一条件 |
| 列 | 下拉选择数据集中的列 |
| 操作符 | 等于、不等于、大于、小于、包含、以...开头、以...结尾、为空、不为空 |
| 值 | 手动输入比较值 |

#### 聚合 (Aggregate)

- 选择分组列
- 选择聚合函数（Sum、Count、Avg、Min、Max）
- 选择要聚合的列

#### 排序 (Sort)

- 选择排序列
- 选择排序方向（升序/降序）
- 支持多列排序

#### 选择列 (Select)

- 勾选要保留的列
- 或选择要排除的列

#### Python Code

提供 Monaco 代码编辑器，支持：
- Python 语法高亮
- 使用 pandas 进行数据处理
- 自动补全提示

#### SQL Query

提供 Monaco 代码编辑器，支持：
- SQL 语法高亮
- 标准 SQL 查询语法
- 对当前数据集执行 SQL

---

## 快捷键参考

### 全局快捷键

| 快捷键 | 功能 |
|--------|------|
| `Ctrl+S` | 保存管道 |
| `Ctrl+Z` | 撤销 |
| `Ctrl+Y` 或 `Ctrl+Shift+Z` | 重做 |

### 画布操作

| 快捷键 | 功能 |
|--------|------|
| `Ctrl+A` | 全选所有节点 |
| `Escape` | 取消选择 / 关闭弹窗 |
| `Delete` 或 `Backspace` | 删除选中项 |
| `Ctrl+C` | 复制选中节点 |
| `Ctrl+V` | 粘贴节点 |
| `Ctrl+D` | 复制节点 |

### 视图控制

| 快捷键 | 功能 |
|--------|------|
| `Ctrl+=` 或 `Ctrl+滚轮向上` | 放大 |
| `Ctrl+-` 或 `Ctrl+滚轮向下` | 缩小 |
| `Ctrl+0` | 恢复 100% 缩放 |
| `Ctrl+1` | 适应窗口 |
| `空格+拖动` | 平移画布 |

---

## 常见操作流程

### 流程1：创建简单的数据筛选管道

```
步骤1: 创建新管道
├── 点击"创建管道"按钮
├── 选择"Batch Pipeline"
├── 输入管道名称
└── 点击"创建管道"

步骤2: 添加数据源
├── 点击"添加数据"下拉菜单
└── 选择"Products"数据集

步骤3: 添加筛选转换
├── 单击 Products 节点
├── 在弹出菜单中点击"Transform"
├── 在转换面板中选择"筛选"
├── 配置筛选条件（如 price > 100）
└── 点击"应用"

步骤4: 添加输出
├── 单击转换节点
├── 在弹出菜单中点击"Transform"
├── 选择输出类型
└── 配置输出目标

步骤5: 保存并运行
├── 点击"保存"按钮
└── 点击"运行"执行管道
```

### 流程2：创建多数据源 Join 管道

```
步骤1: 添加多个数据源
├── 添加"Products"数据集
├── 添加"Transactions"数据集
└── 添加"Customers"数据集

步骤2: 创建第一个 Join
├── 选中 Products 节点
├── 点击"Join"
├── 配置 Join 类型（inner/left/right/full）
├── 指定 Join 列（如 product_id）
└── 连接 Transactions 节点

步骤3: 创建第二个 Join
├── 选中第一个 Join 结果节点
├── 点击"Join"
├── 配置 Join 条件
└── 连接 Customers 节点

步骤4: 添加转换和输出
├── 根据需要添加筛选、聚合等转换
└── 添加输出节点保存结果
```

### 流程3：导出数据

```
方式1: 右键菜单导出
├── 右键点击目标节点
├── 选择"Export data"
├── 选择导出格式（CSV/JSON/Excel）
└── 保存文件

方式2: 工具栏导出
├── 选中要导出的节点
├── 点击工具栏"导出"按钮
├── 选择导出格式
└── 保存文件
```

---

## 右侧面板

### Search Nodes（节点搜索）

快速定位画布上的节点：

```
┌────────────────────────────────────┐
│ 🔍 Search by name, type, or data...│
├────────────────────────────────────┤
│ ☐ Case sensitive                   │
│ ☐ Whole word                       │
│ ☐ Regex                            │
└────────────────────────────────────┘
```

**搜索选项：**
- Case sensitive：区分大小写
- Whole word：全词匹配
- Regex：正则表达式搜索

### 管道输出

显示当前管道的输出配置状态：
- 未配置时显示提示信息
- 点击"添加管道输出"配置输出

### 图例

展示节点类型的颜色标识：
- 🔵 Dataset node（数据集节点）
- 🟢 Transform node（转换节点）
- 🟠 Join node（连接节点）
- 🔴 Output node（输出节点）

### 画布设置

| 设置项 | 默认值 | 说明 |
|--------|--------|------|
| Show grid | 关闭 | 显示背景网格线 |
| Snap to grid | 开启 | 节点自动对齐到网格 |
| Auto layout | 关闭 | 自动排列节点布局 |

---

## 底部面板

### 面板切换按钮

| 按钮 | 功能 |
|------|------|
| 👁️ 选择预览 | 预览选中节点的数据 |
| 📊 预览 | 数据表格预览 |
| 💡 建议 | 系统优化建议 |

### 标签页

| 标签 | 内容 |
|------|------|
| 关于 | 节点基本信息（名称、类型、创建时间等） |
| 列 | 数据列信息和统计 |
| 调度 | 调度配置（定时执行等） |

### 节点详情（关于标签）

选中节点后显示：

```
┌──────────────────────────────────────┐
│ Description                          │
│ ┌────────────────────────────────┐   │
│ │ Add a description for this node│   │
│ └────────────────────────────────┘   │
│                                      │
│ Node Name    Products                │
│ Type         Raw dataset             │
│ Updated      a few seconds ago       │
│ Created      2 minutes ago           │
│ Location     /Ontologize Public/...  │
└──────────────────────────────────────┘
```

---

## 语言切换

系统支持中英文切换：

1. 点击顶部导航栏的语言下拉框
2. 选择"简体中文"或"English"
3. 界面立即切换语言

---

## 附录：转换操作完整列表

### 基础操作
- 筛选 (Filter)
- 选择列 (Select)
- 重命名列 (Rename)
- 删除列 (Remove Column)
- 排序 (Sort)
- 去重 (Distinct)

### 字符串操作
- 去除空格 (Trim)
- 替换值 (Replace)
- 拆分列 (Split)
- 清理字符串 (Clean String)
- 标题大小写 (Title Case)
- 大写 (Uppercase)
- 小写 (Lowercase)
- 连接 (Concatenate)
- 正则提取 (Regex Extract)

### 数值操作
- 类型转换 (Cast)
- 四舍五入 (Round)
- 向下取整 (Floor)
- 向上取整 (Ceiling)
- 绝对值 (Absolute)
- 加法 (Add)
- 减法 (Subtract)
- 乘法 (Multiply)
- 除法 (Divide)

### 日期时间
- 格式化日期 (Format Date)
- 解析日期 (Parse Date)
- 提取年/月/日/时/分 (Extract)
- 日期加减 (Add Days/Months/Years)
- 日期差异 (Date Diff)

### 聚合操作
- 分组聚合 (Group By)
- 透视表 (Pivot)
- 逆透视 (Unpivot)
- 合并 (Union)
- 连接 (Join)

### 高级操作
- 条件列 (Conditional Column)
- 排名 (Rank)
- 行号 (Row Number)
- 滞后值 (Lag)
- 超前值 (Lead)
- 累计求和 (Cumulative Sum)
- 百分位数 (Percentile)

### 代码操作
- Python Code
- SQL Query

---

*文档版本: 1.0*
*最后更新: 2025-11-26*
*适用版本: Pipeline Builder Frontend v0.1.0*
